# 单据服务
## 场景
* 如果要完成一个简单的CRUD功能节点，你需要做什么？
* 如果过两天需求变更了，要加字段，你需要做什么？
* 如果过两天，又要做类似的事情，仅仅是属性不同，你需要做什么？
		
		虽然我们是苦逼的码农，但可以把时间节省出来干点别的有意义的事情，对吧
## 业务建模
* 定义实体元数据
* 定义表单
* 同步元数据
* 注册功能节点
* 生成，并修改功能节点的js文件
* ./jettyrun.sh，浏览器中输入注册的功能节点的url
* done！一个功能节点开发完了
## 示范
		1st_node.md中所描述的就是一个完整的开发过程
## 设计
将企业管理软件中，最基础的，最有共性的逻辑，即业务对象的增删改查(CRUD)抽象出来,使之可以通过简单的配置，扩展就能完成，可以快速上线，投入使用
本质上这是xul的演绎
		//TODO 待补
## 数据结构

		{
			"bill_code":"",
			"layout":"list",
			"ext":"",
			"main":{…},
			"slave":[...]
		}

### bill model
本质上，bill model也算是一种元数据，不妨叫表单元数据，实体元数据是它的子集，单据的模型包括以下属性：


属性编码|值域|是否必填|备注
---:|:---:|:---:|:---
bill_code||Y|单据编码，字符下划线，系统内唯一，按照模块编码+业务对象编码的方式命名
layout|list:tab|Y|子集的界面布局方式，list就是平铺，tab是多页签
ext|bean alias@spirng|Y|单据的数据操作扩展类，用于嵌入各种操作前后的校验和预处理
main|{}|Y|单据的主表对象，是一个meta model
slave|[]|Y|单据的子集列表，是一个meta model list

### meta model


属性编码|值域|是否必填|备注
---:|:---:|:---:|:---
metaCode||Y|实体编码
metaName||Y|实体名称
layout||Y|布局，可选值为:`form`;`grid`	
fields|[]|Y|属性列表
fetch_action|||`只适用于slave的元数据`，用于自定义查询子集，默认值为`xxx`
rlt|{}||只适用于slave meta，用于描述slave与main关系
		
	//TODO 补一下fetch_action啥参数条件的约束问题
#### meta.rlt model

属性编码|属性名称|是否必填|值域|备注
---:|:---:|:---:|:---
rlt_method|||连接方式，取值有force,weak两种，force为默认值，将在删除主表记录时，直接删除子表相关记录，weak则不受影响，只删除主表数据，以及关联关系表记录
bridge|||是否通过rlt表进行桥接，适用于多对多的关系
mainField|||主表的主键
slaveField|||子表的逻辑外键编码

### field model
属性模型，内嵌实体属性元数据

属性编码|属性名称|是否必填|值域|备注
---:|:---:|:---:|:---
code|属性编码|Y|
name|属性名称|Y|
type|属性类型|Y||可选值域为T_PK;T_CODE
showtype|显示位置||适用于主表，值域为head,tail单据的头部或者尾部显示
showlist|||是否在单据的列表状态显示
showcard|||是否在单据的卡片状态显示
cardpos|||卡片状态该属性的显示位置
listpos|||列表状态该属性的显示位置
ispk|是否主键||是否为主键，与type:T_PK配套使用
rangeset|值域||值域，适用于T_CODE,T_STAT两种类型,格式为：v1:lab1@v2:lab2:default@v3:lab3
required|是否必输||
readOnly|是否只读||
config|值域配置||适用于T_REF类型的属性，可以有DS_CODE，param，key可选属性
rlt|||关联关系设置
#### field.config model
field.config之适用于类型为T_REF的属性

配置编码|配置名称|是否必填|备注
---:|:---|:---:|:---
DS_CODE|数据集编码|N|
param||N|需要传递给数据集的参数(has_perm:是否启用数据权限)
key||N|数组，如果该field受其他field控制，可以指定约束关系，受change事件影响




## 显示
	//显示方式：list；card；显示位置；值域设置(变量控制)；表达式设置
## 控制
	//表达式计算
## 场景示范
### 实体映射
#### 单表
#### 主子表(一对多)
#### 主子表(多对多，弱引用)
#### 主子表(多对多，强制引用)
### 属性的表达式
### 属性默认值设置
### 单据约束定义
* 前端约束
* 后端约束

### 显示控制
#### 显示方式
#### 显示位置
#### 参照值域控制
* 参数传递方式(属性间影响：费用科目受部门，报销类型影响)
* 


## FAQ